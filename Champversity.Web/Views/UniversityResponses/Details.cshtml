@model Champversity.DataAccess.Models.UniversityResponse
@{
    ViewData["Title"] = "University Response Details";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var student = ViewBag.Student as Champversity.DataAccess.Models.Student;
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
       <div class="d-flex justify-content-between align-items-center mb-4">
   <h1>
  <i class="bi bi-envelope-open"></i> University Response Details
      </h1>
      <div>
    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Responses
     </a>
 </div>
      </div>
    </div>
 </div>

    <div class="row">
    <!-- Response Information -->
 <div class="col-lg-8">
      <div class="card">
     <div class="card-header">
        <h5 class="mb-0">Response Information</h5>
      </div>
     <div class="card-body">
    <dl class="row">
       <dt class="col-sm-3">Response ID:</dt>
     <dd class="col-sm-9">@Model.Id</dd>
    
       <dt class="col-sm-3">Student ID:</dt>
      <dd class="col-sm-9">@Model.StudentId</dd>
       
        <dt class="col-sm-3">University:</dt>
   <dd class="col-sm-9">@Model.UniversityName</dd>
        
   <dt class="col-sm-3">Response Type:</dt>
       <dd class="col-sm-9">
    <span class="badge bg-info fs-6">@Model.ResponseType</span>
    </dd>
      
   <dt class="col-sm-3">Received Date:</dt>
   <dd class="col-sm-9">@Model.ReceivedDate.ToString("MMMM dd, yyyy HH:mm tt")</dd>
       
      <dt class="col-sm-3">Status:</dt>
     <dd class="col-sm-9">
      @if (Model.IsProcessed)
     {
    <span class="badge bg-success fs-6">
        <i class="bi bi-check-circle"></i> Processed
 </span>
    }
     else
     {
    <span class="badge bg-warning fs-6">
        <i class="bi bi-clock"></i> Pending Processing
      </span>
     }
       </dd>
    
      @if (!string.IsNullOrEmpty(Model.ProcessingNotes))
      {
     <dt class="col-sm-3">Processing Notes:</dt>
      <dd class="col-sm-9">
     <div class="border p-2 rounded bg-light">
     @Html.Raw(Model.ProcessingNotes.Replace("\n", "<br/>"))
      </div>
</dd>
      }
    </dl>
      </div>
  </div>

  <!-- Response Data -->
    <div class="card mt-4">
  <div class="card-header">
       <h5 class="mb-0">Raw Response Data</h5>
 </div>
   <div class="card-body">
     <pre class="bg-light p-3 rounded" style="max-height: 400px; overflow-y: auto;"><code>@Model.ResponseData</code></pre>
   </div>
      </div>
     </div>
        
  <!-- Student Information -->
 <div class="col-lg-4">
      @if (student != null)
        {
     <div class="card">
   <div class="card-header">
    <h5 class="mb-0">Related Student</h5>
      </div>
       <div class="card-body">
     <dl class="row">
       <dt class="col-6">Name:</dt>
       <dd class="col-6">@student.FirstName @student.LastName</dd>
    
     <dt class="col-6">Email:</dt>
      <dd class="col-6">
   <a href="mailto:@student.Email">@student.Email</a>
  </dd>
    
      <dt class="col-6">Phone:</dt>
       <dd class="col-6">
<a href="tel:@student.PhoneNumber">@student.PhoneNumber</a>
      </dd>
  
   <dt class="col-6">University:</dt>
       <dd class="col-6">@student.University</dd>
        
        <dt class="col-6">Program:</dt>
     <dd class="col-6">@student.IntendedProgramMajor</dd>
       
     <dt class="col-6">Status:</dt>
      <dd class="col-6">
      <span class="badge bg-primary">@student.ApplicationStatus</span>
       </dd>
   </dl>
 
      <div class="mt-3">
     <a asp-controller="Application" asp-action="CheckStatus" asp-route-id="@student.Id" 
 class="btn btn-sm btn-outline-primary w-100">
    <i class="bi bi-eye"></i> View Full Application
      </a>
 </div>
   </div>
      </div>
        }
        </div>
   </div>

    @if (!Model.IsProcessed)
  {
      <div class="row mt-4">
      <div class="col-12">
     <div class="card">
     <div class="card-header">
<h5 class="mb-0">Processing Actions</h5>
     </div>
       <div class="card-body">
      <div class="row">
     <div class="col-md-6">
  <form asp-action="MarkAsProcessed" method="post" class="border p-3 rounded">
         <h6>Mark as Processed</h6>
     <input type="hidden" name="id" value="@Model.Id" />
       <div class="mb-3">
       <label for="notes" class="form-label">Processing Notes</label>
     <textarea name="notes" class="form-control" rows="3" placeholder="Add processing notes..."></textarea>
    </div>
       <button type="submit" class="btn btn-success">
      <i class="bi bi-check-circle"></i> Mark as Processed
   </button>
     </form>
      </div>
     
     <div class="col-md-6">
       <div class="border p-3 rounded">
    <h6>Automatic Processing</h6>
     <p class="text-muted">This response can be processed automatically by the batch processing service.</p>
      <p class="text-muted">Interview slots will be created and manual tasks assigned to staff.</p>
      <button class="btn btn-info" onclick="alert('Automatic processing runs every 6 hours')">
      <i class="bi bi-info-circle"></i> Processing Info
    </button>
         </div>
      </div>
     </div>
   </div>
      </div>
      </div>
        </div>
    }
    else
    {
 <div class="row mt-4">
      <div class="col-12">
      <div class="card">
      <div class="card-header">
  <h5 class="mb-0">Additional Actions</h5>
     </div>
    <div class="card-body">
      <form asp-action="Reprocess" method="post" class="d-inline">
       <input type="hidden" name="id" value="@Model.Id" />
       <button type="submit" class="btn btn-warning" 
      onclick="return confirm('Are you sure you want to mark this response for reprocessing?')">
     <i class="bi bi-arrow-clockwise"></i> Mark for Reprocessing
     </button>
    </form>
     </div>
      </div>
      </div>
        </div>
    }
</div>