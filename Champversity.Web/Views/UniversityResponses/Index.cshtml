@model List<Champversity.DataAccess.Models.UniversityResponse>
@{
    ViewData["Title"] = "University Responses";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var responsesWithStudents = ViewBag.ResponsesWithStudents as List<object>;
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
   <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>
             <i class="bi bi-envelope"></i> University Responses
                </h1>
   <div>
       <a asp-action="Pending" class="btn btn-warning">
             <i class="bi bi-clock"></i> Pending (@(Model?.Count(r => !r.IsProcessed) ?? 0))
        </a>
  <a asp-action="Processed" class="btn btn-success">
         <i class="bi bi-check-circle"></i> Processed (@(Model?.Count(r => r.IsProcessed) ?? 0))
        </a>
       </div>
   </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
      <div class="card bg-primary text-white">
           <div class="card-body text-center">
    <h3>@(Model?.Count ?? 0)</h3>
           <p class="mb-0">Total Responses</p>
                </div>
            </div>
        </div>
  <div class="col-md-3">
     <div class="card bg-warning text-white">
    <div class="card-body text-center">
     <h3>@(Model?.Count(r => !r.IsProcessed) ?? 0)</h3>
      <p class="mb-0">Pending Processing</p>
      </div>
            </div>
        </div>
     <div class="col-md-3">
       <div class="card bg-success text-white">
   <div class="card-body text-center">
      <h3>@(Model?.Count(r => r.IsProcessed) ?? 0)</h3>
  <p class="mb-0">Processed</p>
        </div>
      </div>
        </div>
      <div class="col-md-3">
     <div class="card bg-info text-white">
      <div class="card-body text-center">
        <h3>@(Model?.Count(r => r.ResponseType == "InterviewSlots") ?? 0)</h3>
   <p class="mb-0">Interview Slots</p>
  </div>
            </div>
        </div>
    </div>

    @if (Model != null && Model.Any())
    {
    <div class="card">
     <div class="card-header">
       <h5 class="mb-0">All University Responses (@Model.Count)</h5>
            </div>
    <div class="card-body">
              <div class="table-responsive">
    <table class="table table-striped table-hover">
           <thead class="table-dark">
           <tr>
   <th>Response ID</th>
     <th>Student</th>
     <th>University</th>
                <th>Type</th>
           <th>Received</th>
 <th>Status</th>
            <th>Actions</th>
      </tr>
         </thead>
      <tbody>
              @if (responsesWithStudents != null)
          {
  @foreach (var item in responsesWithStudents)
  {
            var responseObj = ((dynamic)item).Response as Champversity.DataAccess.Models.UniversityResponse;
       var studentObj = ((dynamic)item).Student as Champversity.DataAccess.Models.Student;
     
         @if (responseObj != null)
          {
     <tr class="@(responseObj.IsProcessed ? "" : "table-warning")">
         <td>@responseObj.Id</td>
       <td>
            @if (studentObj != null)
    {
          <strong>@studentObj.FirstName @studentObj.LastName</strong><br/>
        <small class="text-muted">@studentObj.Email</small>
  }
              else
    {
         <span class="text-muted">Unknown Student</span>
       }
  </td>
 <td>@responseObj.UniversityName</td>
    <td>
             <span class="badge bg-info">@responseObj.ResponseType</span>
        </td>
   <td>
  <strong>@responseObj.ReceivedDate.ToString("MMM dd, yyyy")</strong><br/>
   <small class="text-muted">@responseObj.ReceivedDate.ToString("HH:mm tt")</small>
           </td>
   <td>
      @if (responseObj.IsProcessed)
      {
 <span class="badge bg-success">
       <i class="bi bi-check-circle"></i> Processed
    </span>
         }
          else
        {
      <span class="badge bg-warning">
    <i class="bi bi-clock"></i> Pending
         </span>
       }
            </td>
    <td>
              <a asp-action="Details" asp-route-id="@responseObj.Id" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-eye"></i> View
           </a>
   </td>
         </tr>
       }
         }
       }
             </tbody>
       </table>
           </div>
            </div>
        </div>
    }
    else
    {
        <div class="card">
  <div class="card-body text-center">
     <i class="bi bi-envelope-x display-1 text-muted"></i>
     <h3 class="mt-3">No University Responses</h3>
         <p class="text-muted">No university responses have been received yet. Responses will appear here when universities reply to submitted applications.</p>
              
        <div class="mt-3">
           <a asp-controller="Test" asp-action="Index" class="btn btn-warning">
         <i class="bi bi-flask"></i> Create Test Responses
        </a>
 </div>
          </div>
</div>
    }
</div>