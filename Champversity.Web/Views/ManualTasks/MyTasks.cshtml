@model List<Champversity.DataAccess.Models.ManualTask>
@{
 ViewData["Title"] = "My Tasks";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var tasksWithStudents = ViewBag.TasksWithStudents as List<object>;
}

<div class="container-fluid">
    <div class="row">
     <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
         <h1>
 <i class="bi bi-person-check"></i> My Tasks
   </h1>
       <div>
         <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-list"></i> All Tasks
  </a>
    </div>
     </div>
        </div>
    </div>

  @if (Model.Any())
    {
     <div class="card">
     <div class="card-header">
      <h5 class="mb-0">Tasks Assigned to Me (@Model.Count)</h5>
  </div>
  <div class="card-body">
            <div class="table-responsive">
         <table class="table table-striped table-hover">
   <thead class="table-dark">
     <tr>
    <th>Task ID</th>
       <th>Student</th>
 <th>Task Type</th>
            <th>Description</th>
 <th>Priority</th>
 <th>Status</th>
   <th>Created</th>
        <th>Actions</th>
    </tr>
      </thead>
     <tbody>
@foreach (var item in tasksWithStudents)
     {
     var task = (Champversity.DataAccess.Models.ManualTask)((dynamic)item).Task;
    var student = (Champversity.DataAccess.Models.Student)((dynamic)item).Student;

    <tr>
            <td>@task.Id</td>
     <td>
    @if (student != null)
         {
         <strong>@student.FirstName @student.LastName</strong><br/>
   <small class="text-muted">@student.Email</small>
          }
 else
      {
      <span class="text-muted">Unknown</span>
    }
         </td>
     <td>
      <span class="badge bg-info">@task.TaskType</span>
 </td>
          <td>
       <div class="text-truncate" style="max-width: 300px;" title="@task.TaskDescription">
    @task.TaskDescription
         </div>
                </td>
    <td>
         <span class="badge bg-@(task.Priority == "High" ? "danger" : task.Priority == "Medium" ? "warning" : "secondary")">
    @task.Priority
  </span>
     </td>
      <td>
          <span class="badge bg-@(task.Status == "Pending" ? "warning" : task.Status == "InProgress" ? "primary" : "success")">
         @task.Status
      </span>
   </td>
      <td>@task.CreatedDate.ToString("MMM dd, yyyy")</td>
  <td>
     <a asp-action="Details" asp-route-id="@task.Id" class="btn btn-sm btn-outline-primary">
    <i class="bi bi-eye"></i> View
     </a>
          </td>
           </tr>
      }
       </tbody>
     </table>
      </div>
 </div>
        </div>
    }
    else
    {
      <div class="card">
            <div class="card-body text-center">
        <i class="bi bi-clipboard-check display-1 text-muted"></i>
     <h3 class="mt-3">No Tasks Assigned</h3>
      <p class="text-muted">You don't have any tasks assigned to you at the moment.</p>
     </div>
        </div>
    }
</div>