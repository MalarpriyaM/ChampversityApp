@model Champversity.DataAccess.Models.ManualTask
@{
    ViewData["Title"] = "Task Details";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var student = ViewBag.Student as Champversity.DataAccess.Models.Student;
}

<div class="container-fluid">
    <div class="row">
 <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
          <h1>
           <i class="bi bi-clipboard-check"></i> Task Details
   </h1>
  <div>
    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Tasks
       </a>
   </div>
 </div>
    </div>
    </div>

    <div class="row">
      <!-- Task Information -->
   <div class="col-lg-8">
        <div class="card">
        <div class="card-header">
   <h5 class="mb-0">Task Information</h5>
     </div>
           <div class="card-body">
    <dl class="row">
      <dt class="col-sm-3">Task ID:</dt>
   <dd class="col-sm-9">@Model.Id</dd>
  
         <dt class="col-sm-3">Task Type:</dt>
            <dd class="col-sm-9">
           <span class="badge bg-info">@Model.TaskType</span>
            </dd>
       
        <dt class="col-sm-3">Description:</dt>
          <dd class="col-sm-9">@Model.TaskDescription</dd>
     
    <dt class="col-sm-3">Priority:</dt>
          <dd class="col-sm-9">
          <span class="badge bg-@(Model.Priority == "High" ? "danger" : Model.Priority == "Medium" ? "warning" : "secondary")">
         @Model.Priority
   </span>
          </dd>
    
                <dt class="col-sm-3">Status:</dt>
            <dd class="col-sm-9">
         <span class="badge bg-@(Model.Status == "Pending" ? "warning" : Model.Status == "InProgress" ? "primary" : "success")">
            @Model.Status
                   </span>
   </dd>
   
               <dt class="col-sm-3">Assigned To:</dt>
    <dd class="col-sm-9">@Model.AssignedTo</dd>
 
              <dt class="col-sm-3">Created:</dt>
            <dd class="col-sm-9">@Model.CreatedDate.ToString("MMMM dd, yyyy HH:mm")</dd>
      
           @if (Model.CompletedDate.HasValue)
      {
        <dt class="col-sm-3">Completed:</dt>
           <dd class="col-sm-9">@Model.CompletedDate.Value.ToString("MMMM dd, yyyy HH:mm")</dd>
    }
               
       @if (!string.IsNullOrEmpty(Model.Notes))
       {
     <dt class="col-sm-3">Notes:</dt>
  <dd class="col-sm-9">
      <div class="border p-2 rounded bg-light">
    @Html.Raw(Model.Notes.Replace("\n", "<br/>"))
      </div>
        </dd>
    }
               </dl>
  </div>
       </div>
        </div>
        
        <!-- Student Information -->
   <div class="col-lg-4">
  @if (student != null)
      {
        <div class="card">
   <div class="card-header">
          <h5 class="mb-0">Student Information</h5>
         </div>
     <div class="card-body">
    <dl class="row">
         <dt class="col-6">Name:</dt>
         <dd class="col-6">@student.FirstName @student.LastName</dd>
         
      <dt class="col-6">Email:</dt>
        <dd class="col-6">
    <a href="mailto:@student.Email">@student.Email</a>
    </dd>
    
      <dt class="col-6">Phone:</dt>
       <dd class="col-6">
           <a href="tel:@student.PhoneNumber">@student.PhoneNumber</a>
           </dd>
    
      <dt class="col-6">University:</dt>
          <dd class="col-6">@student.University</dd>
      
      <dt class="col-6">Program:</dt>
  <dd class="col-6">@student.IntendedProgramMajor</dd>
      
        <dt class="col-6">Status:</dt>
                  <dd class="col-6">
<span class="badge bg-primary">@student.ApplicationStatus</span>
           </dd>
       </dl>
        
       <div class="mt-3">
   <a asp-controller="Application" asp-action="CheckStatus" asp-route-id="@student.Id" 
             class="btn btn-sm btn-outline-primary w-100">
      <i class="bi bi-eye"></i> View Full Application
   </a>
             </div>
     </div>
          </div>
         }
   </div>
    </div>

    @if (Model.Status != "Completed")
    {
        <div class="row mt-4">
            <div class="col-12">
    <div class="card">
          <div class="card-header">
  <h5 class="mb-0">Task Actions</h5>
           </div>
           <div class="card-body">
        <div class="row">
              <!-- Update Status -->
            <div class="col-md-4">
                 <form asp-action="UpdateStatus" method="post" class="border p-3 rounded">
    <h6>Update Status</h6>
     <input type="hidden" name="id" value="@Model.Id" />
   <div class="mb-2">
         <select name="status" class="form-select form-select-sm">
      <option value="Pending" selected="@(Model.Status == "Pending")">Pending</option>
     <option value="InProgress" selected="@(Model.Status == "InProgress")">In Progress</option>
     <option value="Completed" selected="@(Model.Status == "Completed")">Completed</option>
              </select>
    </div>
         <div class="mb-2">
 <textarea name="notes" class="form-control form-control-sm" rows="2" placeholder="Add notes..."></textarea>
    </div>
      <button type="submit" class="btn btn-primary btn-sm">Update Status</button>
        </form>
         </div>
      
         <!-- Assign Task -->
             <div class="col-md-4">
    <form asp-action="Assign" method="post" class="border p-3 rounded">
     <h6>Assign Task</h6>
        <input type="hidden" name="id" value="@Model.Id" />
      <div class="mb-2">
  <select name="assignee" class="form-select form-select-sm">
          <option value="Staff">Staff</option>
       <option value="Admin">Admin</option>
          <option value="@User.Identity.Name">Assign to Me</option>
            </select>
        </div>
      <button type="submit" class="btn btn-warning btn-sm">Assign Task</button>
   </form>
      </div>
              
         <!-- Complete Task -->
            <div class="col-md-4">
     <form asp-action="Complete" method="post" class="border p-3 rounded">
  <h6>Complete Task</h6>
          <input type="hidden" name="id" value="@Model.Id" />
          <div class="mb-2">
        <textarea name="completionNotes" class="form-control form-control-sm" rows="2" placeholder="Completion notes..." required></textarea>
        </div>
          <button type="submit" class="btn btn-success btn-sm">Mark Completed</button>
         </form>
      </div>
      </div>
       </div>
         </div>
       </div>
        </div>
    }
</div>