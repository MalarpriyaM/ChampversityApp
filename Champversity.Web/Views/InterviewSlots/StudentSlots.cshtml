@model List<Champversity.DataAccess.Models.InterviewSlot>
@{
    ViewData["Title"] = "Student Interview Slots";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var student = ViewBag.Student as Champversity.DataAccess.Models.Student;
}

<div class="container-fluid">
    <div class="row">
  <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
       <i class="bi bi-calendar-event"></i> Interview Slots - @student?.FirstName @student?.LastName
    </h1>
                <div>
      <a asp-action="Index" class="btn btn-outline-secondary">
         <i class="bi bi-arrow-left"></i> Back to All Slots
         </a>
          </div>
  </div>
   </div>
    </div>

    @if (student != null)
    {
        <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
     <h5 class="mb-0">Student Information</h5>
           </div>
  <div class="card-body">
 <div class="row">
        <div class="col-md-6">
            <dl class="row">
           <dt class="col-4">Name:</dt>
     <dd class="col-8">@student.FirstName @student.LastName</dd>
   
    <dt class="col-4">Email:</dt>
             <dd class="col-8">@student.Email</dd>
 
     <dt class="col-4">Phone:</dt>
       <dd class="col-8">@student.PhoneNumber</dd>
     </dl>
      </div>
         <div class="col-md-6">
           <dl class="row">
       <dt class="col-4">University:</dt>
      <dd class="col-8">@student.University</dd>
        
        <dt class="col-4">Program:</dt>
               <dd class="col-8">@student.IntendedProgramMajor</dd>
               
        <dt class="col-4">Status:</dt>
           <dd class="col-8">
             <span class="badge bg-primary">@student.ApplicationStatus</span>
  </dd>
          </dl>
          </div>
       </div>
               </div>
        </div>
     </div>
        </div>
    }

    @if (Model.Any())
    {
        <div class="card">
 <div class="card-header">
      <h5 class="mb-0">Available Interview Slots (@Model.Count)</h5>
            </div>
            <div class="card-body">
     @foreach (var slot in Model.OrderBy(s => s.SlotDateTime))
    {
        <div class="card mb-3 @(slot.IsSelected ? "border-success" : "")">
   <div class="card-body">
      <div class="row align-items-center">
          <div class="col-md-4">
     <h5 class="mb-1">
       @slot.SlotDateTime.ToString("MMMM dd, yyyy")
 </h5>
     <p class="mb-0 text-muted">
             <i class="bi bi-clock"></i> @slot.SlotDateTime.ToString("HH:mm tt")
     </p>
            </div>
             <div class="col-md-4 text-center">
         @if (slot.IsSelected)
   {
     <span class="badge bg-success fs-6">
       <i class="bi bi-check-circle"></i> SELECTED
  </span>
          }
        else
     {
        <span class="badge bg-warning fs-6">
 <i class="bi bi-clock"></i> AVAILABLE
 </span>
    }
            </div>
       <div class="col-md-4 text-end">
            @if (!slot.IsSelected)
      {
            <form asp-action="ConfirmSlot" method="post" class="d-inline">
          <input type="hidden" name="slotId" value="@slot.Id" />
        <input type="hidden" name="studentId" value="@student.Id" />
        <button type="submit" class="btn btn-success" 
      onclick="return confirm('Are you sure you want to confirm this interview slot?')">
        <i class="bi bi-check-circle"></i> Confirm Slot
       </button>
            </form>
 }
      else
     {
     <span class="text-success">
 <i class="bi bi-check-circle"></i> Confirmed
            </span>
    }
   </div>
        </div>
             </div>
    </div>
      }
       
    @if (!Model.Any(s => s.IsSelected))
 {
         <div class="mt-4">
      <div class="alert alert-info">
          <h6><i class="bi bi-info-circle"></i> Need Alternative Slots?</h6>
        <p class="mb-0">If none of these slots work for the student, you can request alternative slots from the university.</p>
         </div>
         
  <form asp-action="RequestAlternative" method="post" class="mt-3">
   <input type="hidden" name="studentId" value="@student.Id" />
   <div class="row">
          <div class="col-md-8">
       <textarea name="reason" class="form-control" rows="3" placeholder="Reason for requesting alternative slots..." required></textarea>
            </div>
    <div class="col-md-4">
   <button type="submit" class="btn btn-warning w-100" 
       onclick="return confirm('Are you sure you want to request alternative slots?')">
         <i class="bi bi-arrow-clockwise"></i> Request Alternative Slots
               </button>
         </div>
    </div>
       </form>
  </div>
       }
          </div>
        </div>
    }
    else
    {
        <div class="card">
            <div class="card-body text-center">
            <i class="bi bi-calendar-x display-1 text-muted"></i>
                <h3 class="mt-3">No Interview Slots Available</h3>
           <p class="text-muted">No interview slots have been received for this student yet. Please wait for the university to respond with available slots.</p>
     </div>
     </div>
    }
</div>